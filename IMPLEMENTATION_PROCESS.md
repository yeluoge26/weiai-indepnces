# å¾®çˆ± - åŠŸèƒ½å®ç°æµç¨‹å’Œè§„èŒƒ

## ğŸ“‹ é¡¹ç›®ç»“æ„è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶
- **server.js** (70KB, 2054è¡Œ) - å”¯ä¸€çš„åç«¯æœåŠ¡å™¨æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰APIç«¯ç‚¹
- **public/index.html** (312è¡Œ) - å‰ç«¯åº”ç”¨ï¼ŒåŒ…å«æ‰€æœ‰UIå’ŒåŠŸèƒ½
- **package.json** - å¯åŠ¨è„šæœ¬æŒ‡å‘ `server.js`
- **ecosystem.config.js** - PM2é…ç½®æŒ‡å‘ `server.js`

### âš ï¸ é‡è¦è§„åˆ™
- **åªæœ‰ä¸€ä¸ªserver.jsæ–‡ä»¶** - æ‰€æœ‰åç«¯åŠŸèƒ½éƒ½æ·»åŠ åˆ°è¿™ä¸ªæ–‡ä»¶
- **ç¦æ­¢åˆ›å»ºserver2.jsã€server-new.jsç­‰é‡å¤æ–‡ä»¶**
- **æ‰€æœ‰æ–°åŠŸèƒ½å¿…é¡»ç›´æ¥ç¼–è¾‘server.js**

---

## ğŸ”§ åŠŸèƒ½å®ç°æµç¨‹

### ç¬¬1æ­¥ï¼šåç«¯å®ç°ï¼ˆserver.jsï¼‰

#### 1.1 æ·»åŠ æ•°æ®åº“è¡¨ï¼ˆå¦‚éœ€è¦ï¼‰
ä½ç½®ï¼š`createTables()` å‡½æ•°ä¸­ï¼ˆç¬¬48-472è¡Œï¼‰

```javascript
// åœ¨ createTables() å‡½æ•°ä¸­æ·»åŠ æ–°è¡¨
await conn.execute(`
  CREATE TABLE IF NOT EXISTS newTable (
    id INT AUTO_INCREMENT PRIMARY KEY,
    ...
  )
`);
```

#### 1.2 æ·»åŠ APIç«¯ç‚¹
ä½ç½®ï¼šåœ¨ç›¸åº”åŠŸèƒ½æ¨¡å—çš„æœ«å°¾æ·»åŠ 

**æ¨¡å—ä½ç½®å‚è€ƒï¼š**
- å¥åº·æ£€æŸ¥: ç¬¬508è¡Œ
- ç”¨æˆ·è®¤è¯: ç¬¬513è¡Œ
- ç®¡ç†å‘˜è®¤è¯: ç¬¬682è¡Œ
- AIè§’è‰²ç®¡ç†: ç¬¬727è¡Œ
- èŠå¤©åŠŸèƒ½: ç¬¬857è¡Œ
- æœ‹å‹åœˆ: ç¬¬1041è¡Œ
- é’±åŒ…åŠŸèƒ½: ç¬¬1088è¡Œ
- ç®¡ç†åå°: ç¬¬1227è¡Œ
- APIé…ç½®: ç¬¬1480è¡Œ
- TTSé…ç½®: ç¬¬1635è¡Œ
- ç³»ç»ŸéŸ³è‰²: ç¬¬1716è¡Œ
- ç³»ç»Ÿé…ç½®: ç¬¬1746è¡Œ
- VIPé…ç½®: ç¬¬1777è¡Œ
- æ“ä½œæ—¥å¿—: ç¬¬1810è¡Œ
- ç®¡ç†å‘˜ç®¡ç†: ç¬¬1835è¡Œ
- **ä¸»é¢˜åŠŸèƒ½: ç¬¬1998è¡Œ** â† æ–°åŠŸèƒ½ä»è¿™é‡Œå¼€å§‹

**æ·»åŠ æ ¼å¼ï¼š**
```javascript
// ==================== æ–°åŠŸèƒ½åç§° ====================

// åŠŸèƒ½æè¿°
app.get('/api/path/endpoint', authMiddleware, async (req, res) => {
  try {
    // å®ç°é€»è¾‘
    res.json({ success: true });
  } catch (err) {
    console.error('Error:', err);
    res.status(500).json({ error: { message: 'é”™è¯¯ä¿¡æ¯' } });
  }
});
```

### ç¬¬2æ­¥ï¼šå‰ç«¯å®ç°ï¼ˆpublic/index.htmlï¼‰

#### 2.1 æ·»åŠ HTMLå…ƒç´ 
ä½ç½®ï¼šåœ¨ç›¸åº”é¡µé¢çš„HTMLä¸­æ·»åŠ 

#### 2.2 æ·»åŠ CSSæ ·å¼
ä½ç½®ï¼š`<style>` æ ‡ç­¾ä¸­ï¼ˆç¬¬8-300è¡Œï¼‰

#### 2.3 æ·»åŠ JavaScriptåŠŸèƒ½
ä½ç½®ï¼š`<script>` æ ‡ç­¾ä¸­ï¼ˆç¬¬300+è¡Œï¼‰

**è°ƒç”¨åç«¯APIçš„æ ¼å¼ï¼š**
```javascript
// è·å–æ•°æ®
const response = await fetch('/api/path/endpoint', {
  method: 'GET',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  }
});
const data = await response.json();

// å‘é€æ•°æ®
const response = await fetch('/api/path/endpoint', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ key: value })
});
```

### ç¬¬3æ­¥ï¼šæµ‹è¯•éªŒè¯

#### 3.1 åç«¯æµ‹è¯•
```bash
# å¯åŠ¨æœåŠ¡å™¨
npm start

# æµ‹è¯•APIç«¯ç‚¹
curl -X GET http://localhost:8080/api/endpoint \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### 3.2 å‰ç«¯æµ‹è¯•
- æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8080
- æµ‹è¯•æ–°åŠŸèƒ½çš„æ‰€æœ‰äº¤äº’
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

#### 3.3 æ•°æ®åº“éªŒè¯
```bash
# è¿æ¥æ•°æ®åº“
mysql -u weiai -pweiai2024 weiai

# æŸ¥è¯¢æ–°æ•°æ®
SELECT * FROM newTable;
```

### ç¬¬4æ­¥ï¼šæäº¤ä»£ç 

```bash
# æ·»åŠ æ‰€æœ‰æ›´æ”¹
git add -A

# æäº¤æ›´æ”¹
git commit -m "Add feature: [åŠŸèƒ½åç§°]

- [å…·ä½“æ”¹åŠ¨1]
- [å…·ä½“æ”¹åŠ¨2]
- [å…·ä½“æ”¹åŠ¨3]"

# æ¨é€åˆ°GitHub
git push origin main
```

---

## ğŸ“Š å½“å‰åŠŸèƒ½ç»Ÿè®¡

### åç«¯APIç«¯ç‚¹ï¼ˆ55ä¸ªï¼‰
- GET: 23ä¸ª
- POST: 20ä¸ª
- PUT: 7ä¸ª
- DELETE: 5ä¸ª

### æ•°æ®åº“è¡¨ï¼ˆ21ä¸ªï¼‰
1. users - ç”¨æˆ·è¡¨
2. adminUsers - ç®¡ç†å‘˜è¡¨
3. aiCharacters - AIè§’è‰²è¡¨
4. chatSessions - èŠå¤©ä¼šè¯è¡¨
5. chatMessages - èŠå¤©æ¶ˆæ¯è¡¨
6. userWallets - ç”¨æˆ·é’±åŒ…è¡¨
7. userCharacterAffinity - å¥½æ„Ÿåº¦è¡¨
8. gifts - ç¤¼ç‰©é…ç½®è¡¨
9. giftRecords - ç¤¼ç‰©è®°å½•è¡¨
10. shopItems - å•†å“è¡¨
11. purchaseRecords - è´­ä¹°è®°å½•è¡¨
12. checkInRecords - ç­¾åˆ°è®°å½•è¡¨
13. moments - æœ‹å‹åœˆè¡¨
14. momentLikes - ç‚¹èµè¡¨
15. momentComments - è¯„è®ºè¡¨
16. ttsServiceConfigs - TTSæœåŠ¡é…ç½®è¡¨
17. systemVoices - ç³»ç»ŸéŸ³è‰²è¡¨
18. vipLevelConfigs - VIPç­‰çº§é…ç½®è¡¨
19. userInviteCodes - é‚€è¯·ç è¡¨
20. userInviteRecords - é‚€è¯·è®°å½•è¡¨
21. userThemePreferences - ç”¨æˆ·ä¸»é¢˜åå¥½è¡¨ï¼ˆæ–°å¢ï¼‰

### å¾…æ·»åŠ è¡¨ï¼ˆè®¡åˆ’ä¸­ï¼‰
- characterListings - è§’è‰²ä¸Šæ¶è¡¨
- characterPurchases - è§’è‰²è´­ä¹°è¡¨
- characterReviews - è§’è‰²è¯„ä»·è¡¨
- shareRecords - åˆ†äº«è®°å½•è¡¨
- userSubscriptions - æ¨é€è®¢é˜…è¡¨
- notifications - é€šçŸ¥è¡¨
- registrationAttempts - æ³¨å†Œå°è¯•è¡¨

---

## ğŸ¯ åŠŸèƒ½å®ç°é¡ºåº

### âœ… å·²å®Œæˆï¼ˆç¬¬1é˜¶æ®µï¼‰
1. âœ… ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
2. âœ… AIè§’è‰²ç®¡ç†
3. âœ… èŠå¤©ç³»ç»Ÿ
4. âœ… ç¤¼ç‰©ç³»ç»Ÿ
5. âœ… è™šæ‹Ÿæ”¯ä»˜
6. âœ… å•†åŸç³»ç»Ÿ
7. âœ… æ’è¡Œæ¦œ
8. âœ… ç­¾åˆ°ç³»ç»Ÿ
9. âœ… é€šè®¯å½•
10. âœ… æœ‹å‹åœˆ
11. âœ… TTSè¯­éŸ³
12. âœ… ç®¡ç†å‘˜ç³»ç»Ÿ
13. âœ… VIPç³»ç»Ÿ
14. âœ… é‚€è¯·ç³»ç»Ÿ
15. âœ… ä¸»é¢˜åŠŸèƒ½ï¼ˆåç«¯APIå·²æ·»åŠ ï¼‰

### â³ è¿›è¡Œä¸­ï¼ˆç¬¬2é˜¶æ®µï¼‰
1. â³ æš—é»‘æ¨¡å¼ï¼ˆå‰ç«¯UIå®ç°ä¸­ï¼‰
2. â³ è§’è‰²å¸‚åœº
3. â³ åˆ†äº«å’Œå¯¼å‡ºåŠŸèƒ½
4. â³ æ³¨å†ŒéªŒè¯ç 
5. â³ æ³¨å†Œé™åˆ¶

### ğŸ“… è®¡åˆ’ä¸­ï¼ˆç¬¬3é˜¶æ®µï¼‰
1. ğŸ“… é€Ÿç‡é™åˆ¶
2. ğŸ“… CORSé™åˆ¶
3. ğŸ“… æ•°æ®åº“ç´¢å¼•
4. ğŸ“… æ¨é€åŠŸèƒ½
5. ğŸ“… æ€§èƒ½ç›‘æ§
6. ğŸ“… è‡ªåŠ¨åŒ–æµ‹è¯•

---

## ğŸ” ä»£ç å®¡æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] æ‰€æœ‰æ›´æ”¹éƒ½åœ¨ server.js ä¸­ï¼ˆæ²¡æœ‰åˆ›å»ºæ–°çš„serveræ–‡ä»¶ï¼‰
- [ ] åç«¯APIç«¯ç‚¹å·²æ·»åŠ åˆ° server.js
- [ ] å‰ç«¯ä»£ç å·²æ·»åŠ åˆ° public/index.html
- [ ] æ•°æ®åº“è¡¨å·²åœ¨ createTables() ä¸­åˆ›å»º
- [ ] æ‰€æœ‰é”™è¯¯å¤„ç†éƒ½å·²å®ç°
- [ ] ä»£ç æ³¨é‡Šæ¸…æ™°
- [ ] æ²¡æœ‰ç¡¬ç¼–ç çš„å¯†é’¥æˆ–æ•æ„Ÿä¿¡æ¯
- [ ] æµ‹è¯•é€šè¿‡
- [ ] git commit ä¿¡æ¯æ¸…æ™°

---

## ğŸ“ æ–‡ä»¶ä¿®æ”¹è®°å½•

### server.js ä¿®æ”¹å†å²
| è¡Œå· | åŠŸèƒ½ | æ—¥æœŸ | çŠ¶æ€ |
|------|------|------|------|
| 1998-2031 | ä¸»é¢˜åŠŸèƒ½API | 2026-01-11 | âœ… |
| (å¾…æ·»åŠ ) | è§’è‰²å¸‚åœºAPI | - | â³ |
| (å¾…æ·»åŠ ) | åˆ†äº«åŠŸèƒ½API | - | â³ |
| (å¾…æ·»åŠ ) | å¯¼å‡ºåŠŸèƒ½API | - | â³ |

### public/index.html ä¿®æ”¹å†å²
| è¡Œå· | åŠŸèƒ½ | æ—¥æœŸ | çŠ¶æ€ |
|------|------|------|------|
| (å¾…æ·»åŠ ) | æš—é»‘æ¨¡å¼UI | - | â³ |
| (å¾…æ·»åŠ ) | è§’è‰²å¸‚åœºUI | - | â³ |
| (å¾…æ·»åŠ ) | åˆ†äº«æŒ‰é’® | - | â³ |
| (å¾…æ·»åŠ ) | å¯¼å‡ºæŒ‰é’® | - | â³ |

---

## âš ï¸ å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1ï¼šåˆ›å»ºäº†å¤šä¸ªserveræ–‡ä»¶
**é—®é¢˜**: åˆ›å»ºäº† server2.jsã€server-new.js ç­‰æ–‡ä»¶
**è§£å†³**: åˆ é™¤æ‰€æœ‰é‡å¤æ–‡ä»¶ï¼Œåªä¿ç•™ server.js

### é”™è¯¯2ï¼šåŠŸèƒ½åªåœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œæ²¡æœ‰åˆå¹¶åˆ°server.js
**é—®é¢˜**: æ–°åŠŸèƒ½åœ¨ server-new-apis.js ä¸­ï¼Œä½† server.js æ²¡æœ‰æ›´æ–°
**è§£å†³**: å°†æ‰€æœ‰ä»£ç ç›´æ¥ç¼–è¾‘åˆ° server.js ä¸­

### é”™è¯¯3ï¼šå¿˜è®°æ·»åŠ æ•°æ®åº“è¡¨
**é—®é¢˜**: APIå®ç°äº†ï¼Œä½†æ•°æ®åº“è¡¨æ²¡æœ‰åˆ›å»º
**è§£å†³**: åœ¨ createTables() å‡½æ•°ä¸­æ·»åŠ è¡¨å®šä¹‰

### é”™è¯¯4ï¼šAPIç«¯ç‚¹ä½ç½®ä¸æ¸…æ¥š
**é—®é¢˜**: ä¸çŸ¥é“åœ¨server.jsçš„å“ªé‡Œæ·»åŠ æ–°API
**è§£å†³**: å‚è€ƒä¸Šé¢çš„"æ¨¡å—ä½ç½®å‚è€ƒ"ï¼Œåœ¨ç›¸åº”åŠŸèƒ½æ¨¡å—æœ«å°¾æ·»åŠ 

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

### å¯åŠ¨æœåŠ¡å™¨
```bash
npm start
```

### æŸ¥çœ‹æ—¥å¿—
```bash
pm2 logs weiai
```

### é‡å¯æœåŠ¡å™¨
```bash
npm run restart
```

### åœæ­¢æœåŠ¡å™¨
```bash
npm run stop
```

### æŸ¥çœ‹APIç«¯ç‚¹åˆ—è¡¨
```bash
grep "app\.\(get\|post\|put\|delete\)(" server.js | wc -l
```

### æŸ¥çœ‹æ•°æ®åº“è¡¨åˆ—è¡¨
```bash
grep "CREATE TABLE" server.js | wc -l
```

---

**æœ€åæ›´æ–°**: 2026-01-11
**ç‰ˆæœ¬**: v1.0.0
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª âœ…
